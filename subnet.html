<script>
  function calculate() {
    const ipInput = document.getElementById('ip').value.trim();
    const cidr = parseInt(document.getElementById('mask').value);

    // چک کردن IP معتبر
    const octets = ipInput.split('.').map(Number);
    if (octets.length !== 4  octets.some(o => isNaN(o)  o < 0 || o > 255)) {
      alert("آدرس IP معتبر نیست! مثال: 192.168.1.1");
      return;
    }
    if (isNaN(cidr)  cidr < 1  cidr > 32) {
      alert("ماسک CIDR باید بین ۱ تا ۳۲ باشه!");
      return;
    }

    const mask = ~(0xffffffff >> cidr) & 0xffffffff;
    const network = octets.map((o, i) => (o & (mask >>> (8 * (3 - i)))) >>> 0);
    const broadcast = network.map((o, i) => o | (~(mask >>> (8 * (3 - i))) & 0xff));
    const totalHosts = Math.pow(2, 32 - cidr) - 2;
    const usableHosts = totalHosts < 0 ? 0 : totalHosts;

    const firstHost = usableHosts > 0 ? network.map((o, i) => i === 3 ? o + 1 : o) : network;
    const lastHost = usableHosts > 0 ? broadcast.map((o, i) => i === 3 ? o - 1 : o) : broadcast;

    document.getElementById('result').style.display = 'block';
    document.getElementById('network').textContent = network.join('.');
    document.getElementById('subnetmask').textContent = / ${cidr} → ${cidrToMask(cidr)};
    document.getElementById('broadcast').textContent = broadcast.join('.');
    document.getElementById('firsthost').textContent = firstHost.join('.');
    document.getElementById('lasthost').textContent = lastHost.join('.');
    document.getElementById('hosts').textContent = usableHosts.toLocaleString();
  }

  function cidrToMask(c) {
    const mask = [];
    for (let i = 0; i < 4; i++) {
      const bits = c >= 8 ? 255 : c > 0 ? (0xff << (8 - c)) & 0xff : 0;
      mask.push(bits);
      c -= 8;
    }
    return mask.join('.');
  }
</script>
